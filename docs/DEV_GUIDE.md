# å¼€å‘æŒ‡å—ï¼ˆAâ†’E Pipelineï¼‰

> æ—¥æœŸï¼š2025-08-28

## 1. ç›®æ ‡ä¸äº§ç‰©

- ç›®æ ‡ï¼šæŠŠâ€œæ‹›æ ‡æ–‡ä»¶â€è‡ªåŠ¨è½¬æˆâ€œæŠ•æ ‡æ–‡ä»¶éª¨æ¶/æ–¹æ¡ˆ/è‰æ¡ˆâ€ï¼Œå¹¶è¿›è¡Œåˆè§„å¿«æ£€
- äº§ç‰©ï¼š
  - wiki/æŠ•æ ‡æ–‡ä»¶_éª¨æ¶.md
  - wiki/æŠ€æœ¯è§„æ ¼ä¹¦_æå–.md
  - wiki/æ–¹æ¡ˆ_æçº².md
  - wiki/æŠ•æ ‡æ–‡ä»¶_è‰æ¡ˆ.md
  - wiki/sanity_report.json

## 2. LangGraph æµæ°´çº¿

```
Uploader â†’ Parser(å·²æœ‰)
        â†’ A.StructureExtractor
        â†’ B.SpecExtractor
        â†’ C.PlanOutliner
        â†’ D.BidAssembler
        â†’ E.SanityChecker
```

### Stateï¼ˆç¤ºä¾‹ï¼‰

```python
class BidState(TypedDict, total=False):
    session_id: str
    tender_path: str
    wiki_dir: str
    meta: dict
    outline_sections: list[str]
    outline_path: str
    spec_path: str
    plan_path: str
    draft_path: str
    sanity_report_path: str
```

### ç¼–æ’è°ƒç”¨

```python
from backend.workflow.bid_graph import run_build
run_build("demo", "uploads/æ‹›æ ‡æ–‡ä»¶.md", "wiki", {"project_name":"ç¤ºä¾‹é¡¹ç›®"})
```

## 3. ç»“ç‚¹è¯´æ˜

### A) StructureExtractor

- è§£æâ€œç¬¬äº”ç«  æŠ•æ ‡æ–‡ä»¶æ ¼å¼â€â†’ ç”Ÿæˆç›®å½•éª¨æ¶ï¼›æŠ½ä¸åˆ°å›é€€ 11 é¡¹æ ‡å‡†ç›®å½•
- å½’ä¸€åŒ–å¸¸è§è¿‘ä¹‰é¡¹ï¼šæ–¹æ¡ˆè¯¦ç»†è¯´æ˜åŠæ–½å·¥ç»„ç»‡è®¾è®¡ã€å•†åŠ¡å’ŒæŠ€æœ¯åå·®è¡¨ç­‰

### B) SpecExtractor

- ä»â€œç¬¬å››ç«  æŠ€æœ¯è§„æ ¼ä¹¦/æŠ€æœ¯è¦æ±‚â€åˆ°â€œç¬¬äº”ç« /æŠ•æ ‡æ–‡ä»¶æ ¼å¼â€å‰åˆ‡ç‰‡
- æŠ½ä¸åˆ°æ—¶è¾“å‡º checklist ç‰ˆè§„æ ¼ä¹¦æçº²

### C) PlanOutliner

- æŠŠè¯„åˆ†å› å­æ˜ å°„åˆ°æçº²ï¼ˆæŠ€æœ¯æ–¹æ¡ˆ25 + æ–½å·¥æ–¹æ³•åŠä¸»è¦æŠ€æœ¯æªæ–½25ï¼‰
- æ¯å°èŠ‚å°¾éƒ¨â€œè¯æ®ç»‘å®šï¼šè§„æ ¼ä¹¦ Â§x.xâ€å ä½
- LLMï¼š`get_llm("plan_outliner").complete(prompt)`ï¼Œä¸å¯ç”¨åˆ™å›é€€é»˜è®¤æçº²

### D) BidAssembler

- æ‹¼è£…ï¼šéª¨æ¶ + æ–¹æ¡ˆæçº² + è§„æ ¼ä¹¦èŠ‚é€‰ â†’ è‰æ¡ˆ

### E) SanityChecker

- å¿«æ£€å…³é”®è¦ç´ ï¼šå·¥æœŸ/é‡Œç¨‹ç¢‘/ç¬¬ä¸‰æ–¹æ£€æµ‹/éªŒæ”¶/ç¯ä¿/å®‰å…¨/èµ„æ–™äº¤ä»˜/è´¨é‡æ ‡å‡†/åå·®è¡¨
- è¾“å‡º JSON æŠ¥å‘Šï¼Œå‰ç«¯å¯æç¤º

## 4. Coordinator å¯¹è¯å»ºè®®

- è§¦å‘è¯ï¼šç”ŸæˆæŠ•æ ‡/æ›´æ–°æŠ•æ ‡/build/a2e/ä¸Šä¼ æˆåŠŸç­‰
- æ’­æŠ¥æ¨¡æ¿ï¼š
  1) ğŸ§­ åˆ‡æ¢åˆ° Aâ†’E æµç¨‹
  2) ğŸš€ Aâ€¦ â†’ ğŸ” Bâ€¦ â†’ ğŸ“ Câ€¦ â†’ ğŸ§© Dâ€¦ â†’ âœ… Eâ€¦
  3) åˆ—å‡º 4+1 äº§ç‰©çš„å¯ç‚¹å‡»è·¯å¾„

## 5. å‰ç«¯é›†æˆ

- æ–‡ä»¶æ ‘å±•ç¤º wiki/ï¼›é»˜è®¤æ‰“å¼€ `æŠ•æ ‡æ–‡ä»¶_è‰æ¡ˆ.md`
- â€œé‡æ–°ç”Ÿæˆâ€æŒ‰é’® â†’ POST `/api/v1/proposals/build`
- èŠå¤©é¢æ¿æ˜¾ç¤ºé˜¶æ®µæ’­æŠ¥ï¼ˆå¯é€šè¿‡ invoke_node åˆ†æ­¥ï¼‰

## 6. æ¨¡å‹ä¸ä¸Šä¸‹æ–‡

- `plan_outliner` è¯»å– `æŠ€æœ¯è§„æ ¼ä¹¦_æå–.md` å‰ 12k å­—ï¼Œé¿å…è¶…é•¿ä¸Šä¸‹æ–‡
- æçº²åªåˆ—ç»“æ„ä¸ checklistï¼Œåç»­ç”Ÿæˆå†™ä½œæ›´ç¨³

## 7. æµ‹è¯•ä¸è´¨é‡

```bash
# åç«¯è´¨é‡
cd backend && ruff check . && ruff format .

# å‰ç«¯è´¨é‡
cd frontend && npm run lint && npx tsc --noEmit
```

## 8. å¸¸è§é—®é¢˜

- æ—§æ–‡æ¡ˆä¸å˜ï¼šé‡å¯åç«¯ä¸ä¼šè¯ï¼›æ›´æ–° Coordinator ç³»ç»Ÿæç¤ºï¼›æ”¹ ChatPanel å›ºå®šæ–‡æ¡ˆ
- ç« èŠ‚æŠ½å–å¤±è´¥ï¼šå¯ç”¨ç›®å½•é©±åŠ¨ä¸é»˜è®¤æ¨¡æ¿å›é€€
- åªæƒ³æ›´æ–°æ–¹æ¡ˆï¼šåªé‡è·‘ C/D/E èŠ‚ç‚¹

## 9. æ‰©å±•

- F. DiffTableBuilderï¼šè‡ªåŠ¨ç”Ÿæˆåå·®è¡¨ï¼ˆæ— åå·®è¾“å‡ºâ€œæ— â€ï¼‰
- G. FinalQAï¼šè¯„åˆ†æ˜ å°„ä¸æ¡æ¬¾é€ç‚¹æ ¡éªŒæŠ¥å‘Š